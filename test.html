<!DOCTYPE html>
<html>
<head>
    <title>Pippi Voice - æ ¸å¿ƒè¨ºæ–·ä¸­å¿ƒ</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; background: #f4f7f6; }
        .test-card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pass { color: #2ecc71; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .log { background: #2c3e50; color: #ecf0f1; padding: 10px; border-radius: 4px; font-size: 0.8rem; height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸˆ Pippi Voice æ ¸å¿ƒé‚è¼¯é©—è­‰</h1>
    
    <div class="test-card">
        <h3>1. ç‹€æ…‹æ©Ÿè½‰ç§»é©—è­‰ (State Machine Test)</h3>
        <div id="fsm-test-result">åŸ·è¡Œä¸­...</div>
    </div>

    <div class="test-card">
        <h3>2. é…ç½®å®Œæ•´æ€§æ¸¬è©¦ (Config Audit)</h3>
        <div id="config-test-result">åŸ·è¡Œä¸­...</div>
    </div>

    <h4>åŸ·è¡Œæ—¥èªŒï¼š</h4>
    <div id="debug-log" class="log"></div>

    <script type="module">
        import { StateMachine, AppState } from './src/state.js';
        import { VERSION } from './src/config.js';

        const logEl = document.getElementById('debug-log');
        function log(msg) { logEl.innerHTML += `> ${msg}<br>`; }

        // --- æ¸¬è©¦ FSM ---
        try {
            log(`é–‹å§‹æ¸¬è©¦ v${VERSION} ç‹€æ…‹æ©Ÿ...`);
            let transitions = [];
            const fsm = new StateMachine((state) => {
                transitions.push(state);
                log(`ç‹€æ…‹è½‰ç§»è‡³: ${state}`);
            });

            // æ¨¡æ“¬æ­£å¸¸å·¥ä½œæµ
            fsm.transition(AppState.RECORDING);
            fsm.transition(AppState.FORMATTING);
            fsm.transition(AppState.SUCCESS);

            const resultEl = document.getElementById('fsm-test-result');
            if (transitions.includes('RECORDING') && transitions.includes('FORMATTING') && transitions.includes('SUCCESS')) {
                resultEl.innerHTML = '<span class="pass">âœ” æ¸¬è©¦é€šéï¼šå·¥ä½œæµç‹€æ…‹åˆ‡æ›æ­£ç¢º</span>';
            } else {
                throw new Error('ç‹€æ…‹è½‰ç§»éˆæ¢ä¸å®Œæ•´');
            }
        } catch (e) {
            document.getElementById('fsm-test-result').innerHTML = `<span class="fail">âœ˜ æ¸¬è©¦å¤±æ•—ï¼š${e.message}</span>`;
        }

        // --- æ¸¬è©¦é…ç½® ---
        try {
            log('æª¢æŸ¥ç‰ˆæœ¬ä¸€è‡´æ€§...');
            if (VERSION && VERSION.split('.').length === 3) {
                document.getElementById('config-test-result').innerHTML = `<span class="pass">âœ” æ¸¬è©¦é€šéï¼šç‰ˆæœ¬è™Ÿæ ¼å¼æ­£ç¢º (v${VERSION})</span>`;
            } else {
                throw new Error('ç„¡æ•ˆçš„ç‰ˆæœ¬è™Ÿå®šç¾©');
            }
        } catch (e) {
            document.getElementById('config-test-result').innerHTML = `<span class="fail">âœ˜ æ¸¬è©¦å¤±æ•—ï¼š${e.message}</span>`;
        }
    </script>
</body>
</html>
